<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<title>test.d2</title>
<meta name="generator" content="KF5::SyntaxHighlighting - Definition (D2) - Theme (Breeze Light)"/>
</head><body style="background-color:#ffffff;color:#1f1c1b"><pre>

<span style="color:#898887">"""</span>
<span style="color:#898887">Block comment:</span>
<span style="color:#898887">This file demonstrates:</span>
<span style="color:#898887"> - imports (regular and quoted)</span>
<span style="color:#898887"> - vars &amp; substitutions</span>
<span style="color:#898887"> - containers, nested objects</span>
<span style="color:#898887"> - many shapes: cylinder, sql_table, class, c4-person, circle, square, sequence_diagram</span>
<span style="color:#898887"> - edges with labels (markdown, LaTeX), different arrow kinds</span>
<span style="color:#898887"> - tooltips &amp; links</span>
<span style="color:#898887"> - style blocks and globs (wildcards)</span>
<span style="color:#898887"> - nulling / suspend / unsuspend</span>
<span style="color:#898887"> - scenarios / steps composition</span>
<span style="color:#898887">"""</span>

<span style="color:#898887"># Imports</span>
<span style="color:#898887"># regular import</span>
<span style="color:#ff5500">...@shared</span>

<span style="color:#898887"># quoted import</span>
<span style="color:#ff5500">...@"team.v1"</span>

<span style="color:#898887"># Variables</span>
<span style="font-weight:bold">vars</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="color:#644a9b;font-weight:bold">colors</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
    <span style="color:#644a9b;font-weight:bold">service</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#aa5500">#0B5FFF</span><span style="color:#924c9d">"</span>
    <span style="color:#644a9b;font-weight:bold">db</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#aa5500">#E6F0FF</span><span style="color:#924c9d">"</span>
    <span style="color:#644a9b;font-weight:bold">warn</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#aa5500">#FFDD99</span><span style="color:#924c9d">"</span>
  <span style="color:#ca60ca">}</span>
  <span style="color:#644a9b;font-weight:bold">urls</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
    <span style="color:#644a9b;font-weight:bold">docs</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">https://example.com/docs#top</span><span style="color:#924c9d">"</span>
  <span style="color:#ca60ca">}</span>
<span style="color:#ca60ca">}</span>

<span style="color:#898887"># Global style for the root</span>
<span style="font-weight:bold">style</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="font-weight:bold">fill</span><span style="color:#924c9d">:</span> <span style="color:#aa5500">transparent</span>
  <span style="font-weight:bold">font</span><span style="color:#924c9d">:</span> <span style="color:#b08000">mono</span>
<span style="color:#ca60ca">}</span>

<span style="color:#644a9b;font-weight:bold">client</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">c4-person</span>
  <span style="font-weight:bold">label</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">Client (browser)</span><span style="color:#3daee9">\n</span><span style="color:#bf0303">modern user agent</span><span style="color:#924c9d">"</span>
  <span style="font-weight:bold">tooltip</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">Client provides credentials and interacts with the API.</span><span style="color:#924c9d">"</span>
  <span style="font-weight:bold">link</span><span style="color:#924c9d">:</span> <span style="color:#3daee9">${</span><span style="color:#0057ae">urls</span><span style="color:#924c9d">.</span><span style="color:#0057ae">docs</span><span style="color:#3daee9">}</span>
  <span style="font-weight:bold">width</span><span style="color:#924c9d">:</span> <span style="color:#b08000">90</span>
  <span style="font-weight:bold">height</span><span style="color:#924c9d">:</span> <span style="color:#b08000">90</span>
  <span style="font-weight:bold">style</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">font-size</span><span style="color:#924c9d">:</span> <span style="color:#b08000">10</span><span style="color:#ca60ca">}</span>
<span style="color:#ca60ca">}</span>

<span style="color:#644a9b;font-weight:bold">browser_cache</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">square</span>
  <span style="font-weight:bold">label</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">Browser</span><span style="color:#3daee9">\n</span><span style="color:#bf0303">Cache</span><span style="color:#924c9d">"</span>
  <span style="font-weight:bold">style</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">opacity</span><span style="color:#924c9d">:</span> <span style="color:#b08000">0.9</span><span style="color:#ca60ca">}</span>
<span style="color:#ca60ca">}</span>

<span style="color:#644a9b;font-weight:bold">api_gateway</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">rectangle</span>
  <span style="font-weight:bold">label</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">API Gateway</span><span style="color:#3daee9">\n</span><span style="color:#bf0303">(rate-limits, auth)</span><span style="color:#924c9d">"</span>
  <span style="font-weight:bold">style</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
    <span style="font-weight:bold">fill</span><span style="color:#924c9d">:</span> <span style="color:#3daee9">${</span><span style="color:#0057ae">colors</span><span style="color:#924c9d">.</span><span style="color:#0057ae">service</span><span style="color:#3daee9">}</span>
    <span style="font-weight:bold">font-color</span><span style="color:#924c9d">:</span> <span style="color:#aa5500">white</span>
  <span style="color:#ca60ca">}</span>
<span style="color:#ca60ca">}</span>

<span style="color:#644a9b;font-weight:bold">auth</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">circle</span>
  <span style="font-weight:bold">label</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">Auth</span><span style="color:#3daee9">\n</span><span style="color:#bf0303">(oAuth2 / JWT)</span><span style="color:#924c9d">"</span>
  <span style="font-weight:bold">tooltip</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">Supports PKCE &amp; refresh tokens</span><span style="color:#924c9d">"</span>
<span style="color:#ca60ca">}</span>

<span style="color:#644a9b;font-weight:bold">workers</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">queue</span>
  <span style="font-weight:bold">label</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">Background</span><span style="color:#3daee9">\n</span><span style="color:#bf0303">workers</span><span style="color:#924c9d">"</span>
  <span style="font-weight:bold">style</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">shadow</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">true</span><span style="color:#ca60ca">}</span>
<span style="color:#ca60ca">}</span>

<span style="color:#644a9b;font-weight:bold">db_primary</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">cylinder</span>
  <span style="font-weight:bold">label</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">Postgres</span><span style="color:#3daee9">\n</span><span style="color:#bf0303">Primary</span><span style="color:#924c9d">"</span>
  <span style="font-weight:bold">tooltip</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">primary-db.example.com</span><span style="color:#3daee9">\n</span><span style="color:#bf0303">PG 14</span><span style="color:#924c9d">"</span>
  <span style="font-weight:bold">link</span><span style="color:#924c9d">:</span> <span style="color:#ff5500;font-style:italic">"https://db.example.com/console"</span>
  <span style="font-weight:bold">style</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">fill</span><span style="color:#924c9d">:</span> <span style="color:#3daee9">${</span><span style="color:#0057ae">colors</span><span style="color:#924c9d">.</span><span style="color:#0057ae">db</span><span style="color:#3daee9">}</span><span style="color:#924c9d">;</span> <span style="font-weight:bold">stroke</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#aa5500">#0B4A6F</span><span style="color:#924c9d">"</span><span style="color:#ca60ca">}</span>
<span style="color:#ca60ca">}</span>

<span style="color:#898887"># SQL table</span>
<span style="color:#644a9b;font-weight:bold">users</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">sql_table</span>
  <span style="color:#644a9b;font-weight:bold">id</span><span style="color:#924c9d">:</span> <span style="color:#bf0303">int </span><span style="color:#ca60ca">{</span><span style="font-weight:bold">constraint</span><span style="color:#924c9d">:</span><span style="color:#bf0303"> </span><span style="color:#b08000">primary_key</span><span style="color:#ca60ca">}</span>
  <span style="color:#644a9b;font-weight:bold">name</span><span style="color:#924c9d">:</span> <span style="color:#bf0303">string</span>
  <span style="color:#644a9b;font-weight:bold">email</span><span style="color:#924c9d">:</span> <span style="color:#bf0303">string </span><span style="color:#ca60ca">{</span><span style="font-weight:bold">constraint</span><span style="color:#924c9d">:</span><span style="color:#bf0303"> </span><span style="color:#924c9d">[</span><span style="color:#bf0303">"unique"</span><span style="color:#924c9d">;</span><span style="color:#bf0303"> "not null"</span><span style="color:#924c9d">]</span><span style="color:#ca60ca">}</span>
  <span style="color:#644a9b;font-weight:bold">created_at</span><span style="color:#924c9d">:</span> <span style="color:#bf0303">timestamptz</span>
<span style="color:#ca60ca">}</span>

<span style="color:#898887"># UML class</span>
<span style="color:#644a9b;font-weight:bold">Order</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">class</span>
  <span style="color:#644a9b;font-weight:bold">id</span><span style="color:#924c9d">:</span> <span style="color:#bf0303">int</span>
  <span style="color:#644a9b;font-weight:bold">total</span><span style="color:#924c9d">:</span> <span style="color:#bf0303">float64</span>
  <span style="color:#644a9b;font-weight:bold">placeOrder(customerId</span> <span style="color:#644a9b;font-weight:bold">int)</span><span style="color:#924c9d">:</span> <span style="color:#bf0303">bool</span>
  <span style="color:#644a9b;font-weight:bold">cancel()</span><span style="color:#924c9d">:</span> <span style="color:#bf0303">bool</span>
<span style="color:#ca60ca">}</span>

<span style="color:#644a9b;font-weight:bold">square_node</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">square</span><span style="color:#924c9d">;</span> <span style="font-weight:bold">label</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">square</span><span style="color:#924c9d">"</span><span style="color:#ca60ca">}</span>
<span style="color:#644a9b;font-weight:bold">circle_node</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">circle</span><span style="color:#924c9d">;</span> <span style="font-weight:bold">label</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">circle</span><span style="color:#924c9d">"</span><span style="color:#ca60ca">}</span>

<span style="color:#898887"># Sequence diagram</span>
<span style="color:#644a9b;font-weight:bold">login_sequence</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">sequence_diagram</span>
  <span style="color:#898887"># actors (explicit ordering matters inside sequence_diagram)</span>
  <span style="color:#644a9b;font-weight:bold">client</span>
  <span style="color:#644a9b;font-weight:bold">api_gateway</span>
  <span style="color:#644a9b;font-weight:bold">auth</span>
  <span style="color:#898887"># messages (order matters)</span>
  <span style="color:#644a9b;font-weight:bold">client</span> <span style="color:#ca60ca">-></span> <span style="color:#644a9b;font-weight:bold">api_gateway</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">POST /login</span><span style="color:#924c9d">"</span>
  <span style="color:#644a9b;font-weight:bold">api_gateway</span> <span style="color:#ca60ca">-></span> <span style="color:#644a9b;font-weight:bold">auth</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">validate(credentials)</span><span style="color:#924c9d">"</span>
  <span style="color:#644a9b;font-weight:bold">auth</span> <span style="color:#ca60ca">-></span> <span style="color:#644a9b;font-weight:bold">api_gateway</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">200 OK</span><span style="color:#3daee9">\n</span><span style="color:#bf0303">{ token }</span><span style="color:#924c9d">"</span>
  <span style="color:#644a9b;font-weight:bold">api_gateway</span> <span style="color:#ca60ca">-></span> <span style="color:#644a9b;font-weight:bold">client</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">302 redirect</span><span style="color:#924c9d">"</span>
  <span style="color:#644a9b;font-weight:bold">auth</span> <span style="color:#ca60ca">-></span> <span style="color:#644a9b;font-weight:bold">auth</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">hash(password)</span><span style="color:#924c9d">"</span>
  <span style="color:#644a9b;font-weight:bold">alt</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
    <span style="color:#924c9d">"</span><span style="color:#644a9b;font-weight:bold">invalid creds</span><span style="color:#924c9d">":</span> <span style="color:#ca60ca">{</span>
      <span style="color:#644a9b;font-weight:bold">api_gateway</span> <span style="color:#ca60ca">-></span> <span style="color:#644a9b;font-weight:bold">client</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">401 Unauthorized</span><span style="color:#924c9d">"</span>
    <span style="color:#ca60ca">}</span>
    <span style="color:#924c9d">"</span><span style="color:#644a9b;font-weight:bold">valid creds</span><span style="color:#924c9d">":</span> <span style="color:#ca60ca">{</span>
      <span style="color:#644a9b;font-weight:bold">api_gateway</span> <span style="color:#ca60ca">-></span> <span style="color:#644a9b;font-weight:bold">client</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">302 redirect</span><span style="color:#924c9d">"</span>
    <span style="color:#ca60ca">}</span>
  <span style="color:#ca60ca">}</span>
<span style="color:#ca60ca">}</span>

<span style="color:#898887"># Connections (edges) + labels</span>
<span style="color:#644a9b;font-weight:bold">client</span> <span style="color:#ca60ca">-></span> <span style="color:#644a9b;font-weight:bold">api_gateway</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">REST: POST /v1/session</span><span style="color:#924c9d">"</span>
<span style="color:#644a9b;font-weight:bold">client</span> <span style="color:#ca60ca">-></span> <span style="color:#644a9b;font-weight:bold">browser_cache</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">Cache read (stale-while-revalidate)</span><span style="color:#924c9d">"</span>
<span style="color:#644a9b;font-weight:bold">browser_cache</span> <span style="color:#ca60ca">&lt;-</span> <span style="color:#644a9b;font-weight:bold">api_gateway</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">cache-bust (stale)</span><span style="color:#924c9d">"</span>
<span style="color:#644a9b;font-weight:bold">api_gateway</span> <span style="color:#ca60ca">-></span> <span style="color:#644a9b;font-weight:bold">auth</span><span style="color:#924c9d">:</span> <span style="color:#b08000">|md</span>
  OAuth token exchange
  <span style="color:#b08000">```js</span>
  <span style="color:#644a9b">fetch</span>(<span style="color:#bf0303">'/token'</span>)
  <span style="color:#b08000">```</span>
<span style="color:#b08000">|</span>
<span style="color:#644a9b;font-weight:bold">api_gateway</span> <span style="color:#ca60ca">-></span> <span style="color:#644a9b;font-weight:bold">workers</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">enqueue: `processEmail()`</span><span style="color:#924c9d">"</span>
<span style="color:#644a9b;font-weight:bold">workers</span> <span style="color:#ca60ca">-></span> <span style="color:#644a9b;font-weight:bold">db_primary</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">writes (event logs)</span><span style="color:#924c9d">"</span>
<span style="color:#644a9b;font-weight:bold">api_gateway</span> <span style="color:#ca60ca">&lt;-></span> <span style="color:#644a9b;font-weight:bold">monitoring</span><span style="color:#924c9d">:</span> <span style="color:#b08000">|tex</span>
  <span style="color:#644a9b">\textcolor</span>{green}{E}=mc^2
<span style="color:#b08000">|</span>

<span style="color:#644a9b;font-weight:bold">db_primary</span> <span style="color:#ca60ca">&lt;-</span> <span style="color:#644a9b;font-weight:bold">replica_db</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">replication (async)</span><span style="color:#924c9d">"</span>
<span style="color:#644a9b;font-weight:bold">worker_queue</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">package</span>
  <span style="font-weight:bold">label</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">worker-queue (internal)</span><span style="color:#924c9d">"</span>
  <span style="font-weight:bold">style</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">opacity</span><span style="color:#924c9d">:</span> <span style="color:#b08000">0.6</span><span style="color:#ca60ca">}</span>
<span style="color:#ca60ca">}</span>

<span style="color:#898887"># explicit connection with a multi-line block-string label</span>
<span style="color:#644a9b;font-weight:bold">api_gateway</span> <span style="color:#ca60ca">-></span> <span style="color:#644a9b;font-weight:bold">worker_queue</span><span style="color:#924c9d">:</span> <span style="color:#b08000">|"""md</span>
  Some label:
<span style="color:#ff5500;font-weight:bold">    * </span>bullet 1
<span style="color:#ff5500;font-weight:bold">    * </span>bullet 2

  And an inline <span style="color:#b08000">`code()`</span> snippet.
<span style="color:#b08000">"""|</span>

<span style="color:#644a9b;font-weight:bold">monitoring</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">text</span><span style="color:#924c9d">;</span> <span style="font-weight:bold">label</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">Monitoring</span><span style="color:#924c9d">"</span><span style="color:#ca60ca">}</span>
<span style="color:#644a9b;font-weight:bold">monitoring</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">tooltip</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">OpenTelemetry + Grafana</span><span style="color:#3daee9">\n</span><span style="color:#bf0303">Click to open docs</span><span style="color:#924c9d">";</span> <span style="font-weight:bold">link</span><span style="color:#924c9d">:</span> <span style="color:#3daee9">${</span><span style="color:#0057ae">urls</span><span style="color:#924c9d">.</span><span style="color:#0057ae">docs</span><span style="color:#3daee9">}</span><span style="color:#ca60ca">}</span>

<span style="color:#ca60ca">*</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{!&amp;</span><span style="font-weight:bold;font-style:italic">shape</span><span style="color:#924c9d">:</span> <span style="color:#644a9b;font-style:italic">sql_table</span><span style="color:#924c9d">;</span> <span style="font-weight:bold">style</span><span style="color:#924c9d">.</span><span style="font-weight:bold">opacity</span><span style="color:#924c9d">:</span> <span style="color:#b08000">0.95</span><span style="color:#ca60ca">}</span>

<span style="color:#644a9b;font-weight:bold">temp_user</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">person</span>
  <span style="color:#644a9b;font-weight:bold">name</span><span style="color:#924c9d">:</span> <span style="color:#bf0303">John</span>
<span style="color:#ca60ca">}</span>

<span style="color:#ca60ca">**</span><span style="color:#924c9d">:</span> <span style="color:#b08000">unsuspend</span>
<span style="color:#644a9b;font-weight:bold">temp_user</span><span style="color:#924c9d">:</span> <span style="color:#b08000">suspend</span>

<span style="color:#898887"># names that require quoting (dots, spaces, leading numerals)</span>
<span style="color:#924c9d">"</span><span style="color:#644a9b;font-weight:bold">schema.v1.table</span><span style="color:#924c9d">":</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">page</span><span style="color:#924c9d">;</span> <span style="font-weight:bold">label</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">table with dot in ID</span><span style="color:#924c9d">"</span><span style="color:#ca60ca">}</span>
<span style="color:#924c9d">"</span><span style="color:#644a9b;font-weight:bold">123-start</span><span style="color:#924c9d">":</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">diamond</span><span style="color:#924c9d">;</span> <span style="font-weight:bold">label</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">starts-with-number</span><span style="color:#924c9d">"</span><span style="color:#ca60ca">}</span>
<span style="color:#924c9d">"</span><span style="color:#644a9b;font-weight:bold">complex/name with spaces</span><span style="color:#924c9d">":</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">hexagon</span><span style="color:#924c9d">;</span> <span style="font-weight:bold">label</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">complex ID</span><span style="color:#924c9d">"</span><span style="color:#ca60ca">}</span>

<span style="color:#898887"># Styles on selectors</span>
<span style="color:#ca60ca">*</span><span style="color:#644a9b;font-weight:bold">d</span><span style="color:#ca60ca">*</span><span style="color:#644a9b;font-weight:bold">b</span><span style="color:#ca60ca">*</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">style</span><span style="color:#924c9d">.</span><span style="font-weight:bold">font-size</span><span style="color:#924c9d">:</span> <span style="color:#b08000">12</span><span style="color:#ca60ca">}</span>

<span style="color:#898887"># Nulling a nested attribute</span>
<span style="color:#644a9b;font-weight:bold">users</span><span style="color:#924c9d">.</span><span style="color:#644a9b;font-weight:bold">created_at</span><span style="color:#924c9d">:</span> <span style="color:#b08000">null</span>

<span style="color:#ca60ca">*</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">style</span><span style="color:#924c9d">.</span><span style="font-weight:bold">font-color</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#aa5500">#222</span><span style="color:#924c9d">"</span><span style="color:#ca60ca">}</span>

<span style="color:#ca60ca">*</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{&amp;</span><span style="font-weight:bold;font-style:italic">link</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">*;</span> <span style="font-weight:bold">style</span><span style="color:#924c9d">.</span><span style="font-weight:bold">fill</span><span style="color:#924c9d">:</span> <span style="color:#aa5500">yellow</span><span style="color:#924c9d">;</span> <span style="font-weight:bold">style</span><span style="color:#924c9d">.</span><span style="font-weight:bold">stroke</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#aa5500">#0A8F0A</span><span style="color:#924c9d">"</span><span style="color:#ca60ca">}</span>

<span style="color:#ca60ca">*</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="color:#ca60ca">&amp;</span><span style="font-weight:bold;font-style:italic">shape</span><span style="color:#924c9d">:</span> <span style="color:#644a9b;font-style:italic">c4-person</span>
  <span style="font-weight:bold">style</span><span style="color:#924c9d">.</span><span style="font-weight:bold">fill</span><span style="color:#924c9d">:</span> <span style="color:#3daee9">${</span><span style="color:#0057ae">colors</span><span style="color:#924c9d">.</span><span style="color:#0057ae">warn</span><span style="color:#3daee9">}</span>
<span style="color:#ca60ca">}</span>

<span style="font-weight:bold">scenarios</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="color:#644a9b;font-weight:bold">degraded</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
    <span style="color:#644a9b;font-weight:bold">db_primary</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">style</span><span style="color:#924c9d">.</span><span style="font-weight:bold">opacity</span><span style="color:#924c9d">:</span> <span style="color:#b08000">0.5</span><span style="color:#ca60ca">}</span>
    <span style="color:#644a9b;font-weight:bold">replica_db</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">style</span><span style="color:#924c9d">.</span><span style="font-weight:bold">opacity</span><span style="color:#924c9d">:</span> <span style="color:#b08000">1.0</span><span style="color:#924c9d">;</span> <span style="font-weight:bold">style</span><span style="color:#924c9d">.</span><span style="font-weight:bold">stroke</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#aa5500">#FF0000</span><span style="color:#924c9d">"</span><span style="color:#ca60ca">}</span>
    <span style="color:#644a9b;font-weight:bold">api_gateway</span> <span style="color:#ca60ca">-></span> <span style="color:#644a9b;font-weight:bold">replica_db</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">read-only fallback (degraded)</span><span style="color:#924c9d">"</span>
    <span style="color:#644a9b;font-weight:bold">legacy_db</span><span style="color:#924c9d">:</span> <span style="color:#b08000">null</span> <span style="color:#898887"># overriding with null removes it</span>
  <span style="color:#ca60ca">}</span>
<span style="color:#ca60ca">}</span>

<span style="font-weight:bold">steps</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="color:#644a9b;font-weight:bold">1</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
    <span style="color:#644a9b;font-weight:bold">api_gateway</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">style</span><span style="color:#924c9d">.</span><span style="font-weight:bold">border-radius</span><span style="color:#924c9d">:</span> <span style="color:#b08000">8</span><span style="color:#ca60ca">}</span>
  <span style="color:#ca60ca">}</span>
  <span style="color:#644a9b;font-weight:bold">2</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
    <span style="color:#644a9b;font-weight:bold">api_gateway</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">style</span><span style="color:#924c9d">.</span><span style="font-weight:bold">border-radius</span><span style="color:#924c9d">:</span> <span style="color:#b08000">2</span><span style="color:#924c9d">;</span> <span style="font-weight:bold">style</span><span style="color:#924c9d">.</span><span style="font-weight:bold">stroke-dash</span><span style="color:#924c9d">:</span> <span style="color:#b08000">4</span><span style="color:#ca60ca">}</span>
  <span style="color:#ca60ca">}</span>
<span style="color:#ca60ca">}</span>

<span style="font-weight:bold">layers</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
  <span style="color:#644a9b;font-weight:bold">extra</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span>
    <span style="color:#644a9b;font-weight:bold">emoji_node</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">rectangle</span><span style="color:#924c9d">;</span> <span style="font-weight:bold">label</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">Emoji 🚀 — 測試</span><span style="color:#924c9d">"</span><span style="color:#ca60ca">}</span>
    <span style="color:#644a9b;font-weight:bold">square_node2</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">square</span><span style="color:#924c9d">;</span> <span style="font-weight:bold">width</span><span style="color:#924c9d">:</span> <span style="color:#b08000">40</span><span style="color:#924c9d">;</span>
                                  <span style="font-weight:bold">height</span><span style="color:#924c9d">:</span> <span style="color:#b08000">40</span><span style="color:#ca60ca">}</span>
    <span style="color:#644a9b;font-weight:bold">weird_label_node</span><span style="color:#924c9d">:</span> <span style="color:#ca60ca">{</span><span style="font-weight:bold">shape</span><span style="color:#924c9d">:</span> <span style="color:#b08000">rectangle</span><span style="color:#924c9d">;</span> <span style="font-weight:bold">label</span><span style="color:#924c9d">:</span> <span style="color:#924c9d">"</span><span style="color:#bf0303">This label has a #hash and (paren): check</span><span style="color:#924c9d">"</span><span style="color:#ca60ca">}</span>
  <span style="color:#ca60ca">}</span>
<span style="color:#ca60ca">}</span>
</pre></body></html>
